<div class="card">
    <div class="card-header">
        <strong>{{"AddProjectAndItsTasks" | translate }}</strong>
    </div>
    <div class="card-body">
        <form [formGroup]="projectsForm">
            <ng-container formArrayName="projects">
              <section class="col-md-10 categories-grid" *ngFor="let p of projects().controls ; let projectIndex = index">
                <ng-container [formGroupName]="projectIndex">
                    <section class="col-md-12">
                        <div class="row">
                          <div class="counter">
                            <strong>{{projectIndex+1}}</strong>
                          </div>
                          <div class="col-md-6">
                            <em class="text-danger">*</em>
                            <label for="name">{{'Name' | translate}}</label>
                            <input
                              type="text"
                              class="form-control"
                              id="name"
                              placeholder="Enter project name"
                              formControlName="name"
                            />
                          </div>
                          <!-- <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
                            <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle matTreeNodePadding>
                              <button mat-icon-button disabled></button>
                              <mat-checkbox class="checklist-leaf-node"
                                            [checked]="checklistSelection.isSelected(node)"
                                            (change)="todoLeafItemSelectionToggle(node)">{{node.item}}</mat-checkbox>
                            </mat-tree-node>
                        </mat-tree> -->
                          <div class="col-md-4">
                            <label for="category" class="d-block">
                            <em class="text-danger">*</em>
                              {{'Category' | translate}}</label>
                            <!-- <select class="form-control"
                            id="category"
                            placeholder="Enter Category"
                            formControlName="category">
                            <option value="" disabled selected hidden>{{'SelectCategory' | translate}}</option>
                            <option [value]="category.id" *ngFor="let category of categories">{{category.name}}</option>
                          </select> -->
                          
                           <div class="btn-group" dropdown #dropdown="bs-dropdown" [autoClose]="false">
                             <button id="button-basic" dropdownToggle type="button" 
                                class="btn btn-light dropdown-toggle"
                                aria-controls="dropdown-basic">
                                <span>{{selectedCategory}}</span> 
                             </button>
                             <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu"
                                role="menu" aria-labelledby="button-basic">
                               <li (click)="setParentSelectedCategory(p,category)" *ngFor="let category of categories">
                                 <mat-icon class="ltr-mat-icon" [class.visibity-none]="category.sub.length === 0"  (click)="category.collapsed=true" [hidden]="category.collapsed">keyboard_arrow_right</mat-icon>
                                <mat-icon *ngIf="category.sub && category.collapsed"  (click)="category.collapsed=false" >keyboard_arrow_down</mat-icon>
                                <span class="name"> {{category.name}}</span> 
                                 <div *ngIf="category.sub && category.collapsed">
                                   <ul *ngFor="let sub of category.sub" >
                                     <li (click)="setSelectedCategory(p,sub,$event)"> <span class="name"> {{sub.name}}</span> 
                                     </li>
                                   </ul>
 
                                 </div>
                               </li>
 
                              
                             </ul>
                             
                           </div>
                          </div>
                          <div class="col-md-2 buttons">
                                 <mat-icon (click)="addProject(projectIndex+1)" class="addIcon">add_circle</mat-icon> 
                              
                                  <mat-icon  (click)="deleteProject(projectIndex)" [class.disabled]="p.value.id !== null" class="deleteIcon">delete_forever</mat-icon>
              
                            
                          </div>


                          <div class="col-md-10">
                            <label for="description">{{'Description' | translate}}</label>
                            <textarea
                             class="my-1"
                              rows="5"
                              cols="30"
                              type="text"
                              class="form-control"
                              id="description"
                              placeholder="Enter Project description"
                              formControlName="description"></textarea>
                          </div>
                        </div>
                     </section>
                  <ng-container formArrayName="tasks">
                    <section class="col-md-10 child"  *ngFor="let task of tasks(projectIndex).controls; let taskIndex=index">
                        <div class="row">
                            <ng-container [formGroupName]="taskIndex">
                              <div class="counter">
                                <strong>{{taskIndex+1}}</strong>
                              </div>
                            <div class="col-md-4">
                              <em class="text-danger">*</em>
                              <label for="name">{{'Name' | translate}}</label>
                              <input
                                type="text"
                                class="form-control"
                                id="name"
                                placeholder="Enter task name"
                                formControlName="name"
                              />
                            </div>
                            <div class="col-md-4">
                              <label for="description">{{'Description' | translate}}</label>
                              <input
                                type="text"
                                class="form-control"
                                id="description"
                                placeholder="Enter task description"
                                formControlName="description"
                              />
                            </div>
                            <div class="col-md-3 buttons">
                                    <mat-icon (click)="addTask(projectIndex)" class="addIcon">add_circle</mat-icon> 
                              
                                    <mat-icon  (click)="deleteTask(projectIndex,taskIndex)" [class.disabled]="task.value.id !== null" class="deleteIcon">delete_forever</mat-icon>
                
                            </div>
                            </ng-container>
                        </div>
                    </section>
                  </ng-container>
                </ng-container>
              </section>
          </ng-container>
          <div class="form-row action-btn-container">
            <button mat-raised-button color="primary" class="w-30"
            (click)="cancel()">
            <mat-icon> cancel_presentation</mat-icon>
            {{'Cancel' | translate}}
           </button>
            <button mat-raised-button color="primary" class="w-30"
             (click)="submitForm()" [disabled]="checkDisable()">
             <mat-icon>add_circle</mat-icon> 
             {{'Save' | translate}}
            </button>
        
           </div>
            </form>
    </div>
</div>

    